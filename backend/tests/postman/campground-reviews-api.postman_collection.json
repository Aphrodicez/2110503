{
  "info": {
    "name": "Campground Reviews API Runner",
    "description": "Collection to verify review functionalities for the Campground Booking backend.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
    "version": {
      "major": 1,
      "minor": 0,
      "patch": 0
    }
  },
  "item": [
    {
      "name": "Setup (Admin)",
      "item": [
        {
          "name": "Register Admin",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "const ts = Date.now();",
                  "pm.environment.set('adminEmail', 'admin_rev_' + ts + '@runner.test');",
                  "pm.environment.set('adminPassword', 'Admin!' + ts);",
                  "pm.environment.set('adminTelephone', '08' + String(ts % 1000000000).padStart(9, '0'));"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Register admin succeeds', function () {",
                  "    pm.response.to.have.status(200);",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.success).to.be.true;",
                  "    pm.environment.set('adminToken', json.token);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Review Admin\",\n  \"email\": \"{{adminEmail}}\",\n  \"telephone\": \"{{adminTelephone}}\",\n  \"password\": \"{{adminPassword}}\",\n  \"role\": \"admin\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/register",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "auth",
                "register"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Create Campground (Admin)",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "const ts = Date.now();",
                  "pm.environment.set('campgroundName', 'Review Camp ' + ts);"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Campground created', function () {",
                  "    pm.response.to.have.status(200);",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.success).to.be.true;",
                  "    pm.environment.set('campgroundId', json.data._id);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"{{campgroundName}}\",\n  \"address\": \"99 Review Road\",\n  \"district\": \"Review District\",\n  \"province\": \"Review Province\",\n  \"postalcode\": \"54321\",\n  \"tel\": \"02-9876543\",\n  \"region\": \"North\",\n \"image\": \"https://example.com/review-camp.jpg\",\n  \"price\": 100\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/campgrounds",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "campgrounds"
              ]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "User Flow",
      "item": [
        {
          "name": "Register User",
          "event": [
            {
              "listen": "prerequest",
              "script": {
                "exec": [
                  "const ts = Date.now();",
                  "pm.environment.set('userEmail', 'reviewer_' + ts + '@runner.test');",
                  "pm.environment.set('userPassword', 'User!' + ts);",
                  "pm.environment.set('userTelephone', '09' + String(ts % 1000000000).padStart(9, '0'));"
                ],
                "type": "text/javascript"
              }
            },
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Register user succeeds', function () {",
                  "    pm.response.to.have.status(200);",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.success).to.be.true;",
                  "    pm.environment.set('userToken', json.token);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"name\": \"Reviewer User\",\n  \"email\": \"{{userEmail}}\",\n  \"telephone\": \"{{userTelephone}}\",\n  \"password\": \"{{userPassword}}\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/auth/register",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "auth",
                "register"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Create Review (Success)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Review created', function () {",
                  "    pm.response.to.have.status(201);",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.success).to.be.true;",
                  "    pm.expect(json.data.rating).to.eql(5);",
                  "    pm.environment.set('reviewId', json.data._id);",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{userToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"rating\": 5,\n  \"comment\": \"This is a great campground!\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/campgrounds/{{campgroundId}}/reviews",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "campgrounds",
                "{{campgroundId}}",
                "reviews"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Create Duplicate Review (Fail)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Duplicate review fails', function () {",
                  "    // Expecting 400 or 500 depending on how mongoose error is handled",
                  "    pm.expect(pm.response.code).to.be.oneOf([400, 500]);",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.success).to.be.false;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{userToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"rating\": 4,\n  \"comment\": \"Trying to review again\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/campgrounds/{{campgroundId}}/reviews",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "campgrounds",
                "{{campgroundId}}",
                "reviews"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Create Review Invalid Rating (Fail)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Invalid rating fails', function () {",
                  "    pm.response.to.have.status(400);",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.success).to.be.false;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{userToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"rating\": 6,\n  \"comment\": \"Invalid rating\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/campgrounds/{{campgroundId}}/reviews",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "campgrounds",
                "{{campgroundId}}",
                "reviews"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Get Reviews for Campground",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Reviews returned', function () {",
                  "    pm.response.to.have.status(200);",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.success).to.be.true;",
                  "    pm.expect(json.count).to.be.at.least(1);",
                  "    pm.expect(json.data[0].campground).to.eql(pm.environment.get('campgroundId'));",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/campgrounds/{{campgroundId}}/reviews",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "campgrounds",
                "{{campgroundId}}",
                "reviews"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Get Single Review",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Single review returned', function () {",
                  "    pm.response.to.have.status(200);",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.success).to.be.true;",
                  "    pm.expect(json.data._id).to.eql(pm.environment.get('reviewId'));",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "GET",
            "url": {
              "raw": "{{baseUrl}}/reviews/{{reviewId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "reviews",
                "{{reviewId}}"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Update Review",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Review updated', function () {",
                  "    pm.response.to.have.status(200);",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.success).to.be.true;",
                  "    pm.expect(json.data.rating).to.eql(4);",
                  "    pm.expect(json.data.comment).to.eql(\"Updated comment\");",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              },
              {
                "key": "Authorization",
                "value": "Bearer {{userToken}}"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"rating\": 4,\n  \"comment\": \"Updated comment\"\n}"
            },
            "url": {
              "raw": "{{baseUrl}}/reviews/{{reviewId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "reviews",
                "{{reviewId}}"
              ]
            }
          },
          "response": []
        },
        {
          "name": "Delete Review",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Review deleted', function () {",
                  "    pm.response.to.have.status(200);",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.success).to.be.true;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{userToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/reviews/{{reviewId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "reviews",
                "{{reviewId}}"
              ]
            }
          },
          "response": []
        }
      ]
    },
    {
      "name": "Cleanup",
      "item": [
        {
          "name": "Delete Campground (Admin)",
          "event": [
            {
              "listen": "test",
              "script": {
                "exec": [
                  "pm.test('Campground deleted', function () {",
                  "    pm.response.to.have.status(200);",
                  "    const json = pm.response.json();",
                  "    pm.expect(json.success).to.be.true;",
                  "});"
                ],
                "type": "text/javascript"
              }
            }
          ],
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Authorization",
                "value": "Bearer {{adminToken}}"
              }
            ],
            "url": {
              "raw": "{{baseUrl}}/campgrounds/{{campgroundId}}",
              "host": [
                "{{baseUrl}}"
              ],
              "path": [
                "campgrounds",
                "{{campgroundId}}"
              ]
            }
          },
          "response": []
        }
      ]
    }
  ],
  "variable": [
    {
      "key": "baseUrl",
      "value": "http://localhost:5000/api/v1"
    },
    {
      "key": "adminEmail",
      "value": ""
    },
    {
      "key": "adminPassword",
      "value": ""
    },
    {
      "key": "adminTelephone",
      "value": ""
    },
    {
      "key": "adminToken",
      "value": ""
    },
    {
      "key": "userEmail",
      "value": ""
    },
    {
      "key": "userPassword",
      "value": ""
    },
    {
      "key": "userTelephone",
      "value": ""
    },
    {
      "key": "userToken",
      "value": ""
    },
    {
      "key": "campgroundId",
      "value": ""
    },
    {
      "key": "campgroundName",
      "value": ""
    },
    {
      "key": "reviewId",
      "value": ""
    }
  ]
}
